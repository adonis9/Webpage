<!-- FORCE DEPLOY TEST -->
<script>
let horses = [];
let races = [];

try {
  horses = JSON.parse(localStorage.getItem("horses")) || [];
  races = JSON.parse(localStorage.getItem("races")) || [];
} catch (e) {
  console.warn("LocalStorage unavailable or corrupted â€” starting fresh");
  horses = [];
  races = [];
}

function save() {
  try {
    localStorage.setItem("horses", JSON.stringify(horses));
    localStorage.setItem("races", JSON.stringify(races));
  } catch (e) {
    console.warn("Could not save to localStorage");
  }
}

function addHorse() {
  const name = document.getElementById("horseName").value.trim();
  const house = document.getElementById("horseHouse").value.trim();
  if (!name || !house) return alert("Fill all fields");
  horses.push({ name, house });
  save();
  render();
}

function addRace() {
  const name = document.getElementById("raceName").value.trim();
  if (!name) return alert("Enter a race name");
  races.push({ name, horses: [] });
  save();
  render();
}

function addHorseToRace(r, h) {
  if (!races[r] || !horses[h]) return;
  races[r].horses.push(horses[h]);
  save();
  render();
}

function removeHorseFromRace(r, h) {
  if (!races[r] || !races[r].horses[h]) return;
  races[r].horses.splice(h, 1);
  save();
  render();
}

function render() {
  const racesDiv = document.getElementById("races");
  racesDiv.innerHTML = "";
  races.forEach((race, rIndex) => {
    const div = document.createElement("div");
    div.className = "race";
    div.innerHTML = `<strong>${race.name}</strong>`;

    race.horses.forEach((h, hIndex) => {
      div.innerHTML += `<div class="horse">
        ${h.name} (House ${h.house})
        <button onclick="removeHorseFromRace(${rIndex}, ${hIndex})">Remove</button>
      </div>`;
    });

    const select = document.createElement("select");
    horses.forEach((h, i) => {
      const o = document.createElement("option");
      o.value = i;
      o.textContent = `${h.name} (House ${h.house})`;
      select.appendChild(o);
    });

    const btn = document.createElement("button");
    btn.textContent = "Add Horse to Race";
    btn.onclick = () => addHorseToRace(rIndex, select.value);

    div.appendChild(select);
    div.appendChild(btn);
    racesDiv.appendChild(div);
  });
}

window.addEventListener("DOMContentLoaded", render);
</script>
